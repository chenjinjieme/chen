<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.chen.aigis.dao.PngDao">
    <resultMap id="character" type="com.chen.aigis.bean.Character" autoMapping="true">
        <id property="id" column="id"/>
        <collection property="pngs" ofType="com.chen.aigis.bean.Character$Png" autoMapping="true">
            <id property="name" column="name"/>
        </collection>
    </resultMap>
    <select id="getByCharacter" resultType="map">
        SELECT u.name,
               u.url,
               p.count
        FROM png p
                 INNER JOIN url u ON p.url = u.id
                 LEFT JOIN unit c ON p.unit = c.id
        WHERE c.unit = #{character}
    </select>
    <select id="getAll" resultMap="character">
        SELECT p.unit id,
               c.unit character,
               c.own,
               u.name,
               u.url,
               p.count
        FROM png p
                 LEFT JOIN url u ON p.url = u.id
                 LEFT JOIN unit c ON p.unit = c.id
        ORDER BY p.unit, p.type, p."index"
    </select>
    <insert id="add">
        INSERT INTO png(unit, type, "index", url)
        SELECT #{character},
               #{type},
               #{index},
               max(id)
        FROM url
    </insert>
</mapper>
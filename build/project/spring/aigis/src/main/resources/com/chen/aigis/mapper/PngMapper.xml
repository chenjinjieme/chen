<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.chen.aigis.dao.PngDao">
    <resultMap id="character" type="com.chen.aigis.bean.Character" autoMapping="true">
        <id property="id" column="id"/>
        <collection property="pngs" ofType="com.chen.aigis.bean.Character$Png" autoMapping="true">
            <id property="name" column="name"/>
        </collection>
    </resultMap>
    <select id="getByCharacter" resultType="map">
        SELECT u.name,
               u.url,
               p.count
        FROM png p
                 INNER JOIN url u ON p.url = u.id
                 LEFT JOIN `character` c ON p.`character` = c.id
        WHERE c.name = #{character}
    </select>
    <select id="getAll" resultMap="character">
        SELECT p.`character` id,
               c.name        `character`,
               u.name,
               u.url,
               p.count
        FROM png p
                 LEFT JOIN url u ON p.url = u.id
                 LEFT JOIN `character` c ON p.`character` = c.id
        ORDER BY p.`character`, p.type, p.`index`
    </select>
    <insert id="add">
        INSERT png (`character`, type, `index`, url)
        SELECT #{character},
               #{type},
               #{index},
               max(id)
        FROM url
    </insert>
</mapper>